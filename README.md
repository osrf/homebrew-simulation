Build | Status
-- | --
macOS 10.15 GitHub action | [![Build Status](![brew test-bot](https://github.com/osrf/homebrew-simulation/workflows/brew%20test-bot/badge.svg?branch=master&event=push))

homebrew-simulation
===================

Homebrew tap for osrf simulation software

To use:

    brew tap osrf/simulation
    brew install ignition-citadel

## Bottle status

### Ignition Dome

* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_cmake2-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_cmake2-install_bottle-homebrew-amd64/)           [ignition_cmake2](https://build.osrfoundation.org/view/ign-dome/job/ignition_cmake2-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_tools1-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_tools1-install_bottle-homebrew-amd64/)           [ignition_tools1](https://build.osrfoundation.org/view/ign-dome/job/ignition_tools1-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_math6-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_math6-install_bottle-homebrew-amd64/)             [ignition_math6](https://build.osrfoundation.org/view/ign-dome/job/ignition_math6-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_common3-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_common3-install_bottle-homebrew-amd64/)         [ignition_common3](https://build.osrfoundation.org/view/ign-dome/job/ignition_common3-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_msgs6-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_msgs6-install_bottle-homebrew-amd64/)             [ignition_msgs6](https://build.osrfoundation.org/view/ign-dome/job/ignition_msgs6-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_fuel-tools5-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_fuel-tools5-install_bottle-homebrew-amd64/) [ignition_fuel-tools5](https://build.osrfoundation.org/view/ign-dome/job/ignition_fuel-tools5-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_plugin1-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_plugin1-install_bottle-homebrew-amd64/)         [ignition_plugin1](https://build.osrfoundation.org/view/ign-dome/job/ignition_plugin1-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_transport9-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_transport9-install_bottle-homebrew-amd64/)   [ignition_transport9](https://build.osrfoundation.org/view/ign-dome/job/ignition_transport9-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_physics3-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_physics3-install_bottle-homebrew-amd64/)       [ignition_physics3](https://build.osrfoundation.org/view/ign-dome/job/ignition_physics3-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_rendering4-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_rendering4-install_bottle-homebrew-amd64/)   [ignition_rendering4](https://build.osrfoundation.org/view/ign-dome/job/ignition_rendering4-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_gui4-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_gui4-install_bottle-homebrew-amd64/)               [ignition_gui4](https://build.osrfoundation.org/view/ign-dome/job/ignition_gui4-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_sensors4-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_sensors4-install_bottle-homebrew-amd64/)       [ignition_sensors4](https://build.osrfoundation.org/view/ign-dome/job/ignition_sensors4-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_gazebo4-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_gazebo4-install_bottle-homebrew-amd64/)         [ignition_gazebo4](https://build.osrfoundation.org/view/ign-dome/job/ignition_gazebo4-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_launch3-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_launch3-install_bottle-homebrew-amd64/)         [ignition_launch3](https://build.osrfoundation.org/view/ign-dome/job/ignition_launch3-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_dome-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-dome/job/ignition_dome-install_bottle-homebrew-amd64/)               [ignition_dome](https://build.osrfoundation.org/view/ign-dome/job/ignition_dome-install_bottle-homebrew-amd64/)

### Ignition Citadel

* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_cmake2-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_cmake2-install_bottle-homebrew-amd64/)           [ignition_cmake2](https://build.osrfoundation.org/view/ign-citadel/job/ignition_cmake2-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_tools1-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_tools1-install_bottle-homebrew-amd64/)           [ignition_tools1](https://build.osrfoundation.org/view/ign-citadel/job/ignition_tools1-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_math6-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_math6-install_bottle-homebrew-amd64/)             [ignition_math6](https://build.osrfoundation.org/view/ign-citadel/job/ignition_math6-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_common3-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_common3-install_bottle-homebrew-amd64/)         [ignition_common3](https://build.osrfoundation.org/view/ign-citadel/job/ignition_common3-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_msgs5-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_msgs5-install_bottle-homebrew-amd64/)             [ignition_msgs5](https://build.osrfoundation.org/view/ign-citadel/job/ignition_msgs5-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_fuel-tools4-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_fuel-tools4-install_bottle-homebrew-amd64/) [ignition_fuel-tools4](https://build.osrfoundation.org/view/ign-citadel/job/ignition_fuel-tools4-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_plugin1-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_plugin1-install_bottle-homebrew-amd64/)         [ignition_plugin1](https://build.osrfoundation.org/view/ign-citadel/job/ignition_plugin1-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_transport8-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_transport8-install_bottle-homebrew-amd64/)   [ignition_transport8](https://build.osrfoundation.org/view/ign-citadel/job/ignition_transport8-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_physics2-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_physics2-install_bottle-homebrew-amd64/)       [ignition_physics2](https://build.osrfoundation.org/view/ign-citadel/job/ignition_physics2-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_rendering3-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_rendering3-install_bottle-homebrew-amd64/)   [ignition_rendering3](https://build.osrfoundation.org/view/ign-citadel/job/ignition_rendering3-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_gui3-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_gui3-install_bottle-homebrew-amd64/)               [ignition_gui3](https://build.osrfoundation.org/view/ign-citadel/job/ignition_gui3-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_sensors3-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_sensors3-install_bottle-homebrew-amd64/)       [ignition_sensors3](https://build.osrfoundation.org/view/ign-citadel/job/ignition_sensors3-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_gazebo3-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_gazebo3-install_bottle-homebrew-amd64/)         [ignition_gazebo3](https://build.osrfoundation.org/view/ign-citadel/job/ignition_gazebo3-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_launch2-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_launch2-install_bottle-homebrew-amd64/)         [ignition_launch2](https://build.osrfoundation.org/view/ign-citadel/job/ignition_launch2-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_citadel-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-citadel/job/ignition_citadel-install_bottle-homebrew-amd64/)         [ignition_citadel](https://build.osrfoundation.org/view/ign-citadel/job/ignition_citadel-install_bottle-homebrew-amd64/)

### Ignition Blueprint

* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_cmake2-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_cmake2-install_bottle-homebrew-amd64/)           [ignition_cmake2](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_cmake2-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_tools1-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_tools1-install_bottle-homebrew-amd64/)           [ignition_tools1](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_tools1-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_math6-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_math6-install_bottle-homebrew-amd64/)             [ignition_math6](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_math6-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_common3-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_common3-install_bottle-homebrew-amd64/)         [ignition_common3](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_common3-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_msgs4-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_msgs4-install_bottle-homebrew-amd64/)             [ignition_msgs4](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_msgs4-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_fuel-tools3-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_fuel-tools3-install_bottle-homebrew-amd64/) [ignition_fuel-tools3](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_fuel-tools3-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_plugin1-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_plugin1-install_bottle-homebrew-amd64/)         [ignition_plugin1](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_plugin1-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_transport7-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_transport7-install_bottle-homebrew-amd64/)   [ignition_transport7](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_transport7-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_physics1-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_physics1-install_bottle-homebrew-amd64/)       [ignition_physics1](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_physics1-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_rendering2-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_rendering2-install_bottle-homebrew-amd64/)   [ignition_rendering2](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_rendering2-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_gui2-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_gui2-install_bottle-homebrew-amd64/)               [ignition_gui2](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_gui2-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_sensors2-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_sensors2-install_bottle-homebrew-amd64/)       [ignition_sensors2](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_sensors2-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_gazebo2-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_gazebo2-install_bottle-homebrew-amd64/)         [ignition_gazebo2](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_gazebo2-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_launch1-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_launch1-install_bottle-homebrew-amd64/)         [ignition_launch1](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_launch1-install_bottle-homebrew-amd64/)
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=ignition_blueprint-install_bottle-homebrew-amd64)](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_blueprint-install_bottle-homebrew-amd64/)         [ignition_blueprint](https://build.osrfoundation.org/view/ign-blueprint/job/ignition_blueprint-install_bottle-homebrew-amd64/)

## To build bottles

The https://build.osrfoundation.org jenkins instance is used for building bottles with the following job
(configured in [brew_release.dsl](https://github.com/ignition-tooling/release-tools/blob/master/jenkins-scripts/dsl/brew_release.dsl)):

* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=generic-release-homebrew_triggered_bottle_builder)](https://build.osrfoundation.org/job/generic-release-homebrew_triggered_bottle_builder/) https://build.osrfoundation.org/job/generic-release-homebrew_triggered_bottle_builder/

This jenkins job is triggered for pull requests when an administrator makes a comment
on the pull request that includes the phrase `build bottle`.
The job should appear in the GitHub build status interface for the latest commit:

![GitHub build status interface screenshot](.github/github_build_status.png)

For example, osrf/homebrew-simulation#1157 was created after
running our [release.py](https://github.com/ignition-tooling/release-tools/blob/master/release.py) script
and [this comment](https://github.com/osrf/homebrew-simulation/pull/1157#issuecomment-698111311)
triggered the bottle build, resulting in a successful bottle upload and a47933878a7e073225acf5ceef0960cd6cfd50b2.

Bottle builds are not triggered automatically for every pull request for several reasons:

* Not all pull requests require a bottle to be rebuilt (such as #1007 that added this text to the README)
* Successful bottle builds result in binary artifacts being immediately uploaded to our hosting provider
  so pull requests should be screened for malicious intent by administrators before triggering
  a bottle build.
    - This process differs from the approach taken by
      [homebrew/homebrew-core](https://github.com/Homebrew/homebrew-core)
      whose bottles are hosted at Bintray, which has a
      [different publishing mechanism](https://www.jfrog.com/confluence/display/BT/Managing+Uploaded+Content#ManagingUploadedContent-Publishing)
      than s3.
      Files uploaded to Bintray are not immediately available for public download;
      they must first be published.
      If they are not published within 7 days of upload, they are automatically deleted.
      The homebrew-core CI jobs will build bottles for any incoming pull request,
      which will upload bottles directly to bintray, but these bottles will not be
      publicly available unless the pull request is merged by a homebrew maintainer
      within 7 days.

## Troubleshotting

* I commented `build bottle`, but it did not start a
  [generic-release-homebrew\_triggered\_bottle\_builder](https://build.osrfoundation.org/job/generic-release-homebrew_triggered_bottle_builder)
  job.
    - Confirm that the build.osrfoundation.org web page loads. If it is not accessible, an OSRF build farmer should be notified.
    - If build.osrfoundation.org is operational, confirm that you have adequate permissions.
      Currently, you must be a member of the github.com/ignitionrobotics org in order to use
      the `build bottle` trigger phrase (see configuration in [brew_release.dsl](https://github.com/ignition-tooling/release-tools/blob/2ae0424303a5/jenkins-scripts/dsl/brew_release.dsl#L181-L185)).

* I ran the [release.py](https://github.com/ignition-tooling/release-tools/blob/master/release.py) script multiple
  times for the same release and commented `build bottle` on the pull request, but the bottle building job failed,
  with console output containing the text `Warning: Formula reports different SHA256:`.
    - It's possible that the tarball uploaded at the time the pull request was created was overwritten
      by a subsequent call to `release.py` (see ignition-tooling/release-tools#274).
      If so, update the `sha256` field for the tarball (see #1156 and 57fa5defcce for an example).

## Jenkins implementation details

The [generic-release-homebrew\_triggered\_bottle\_builder](https://build.osrfoundation.org/job/generic-release-homebrew_triggered_bottle_builder)
jenkins job currently builds bottles for macOS 10.13 `high_sierra` and 10.14 `mojave`
using the following job configurations and the
[homebrew\_bottle\_creation.bash](https://github.com/ignition-tooling/release-tools/blob/master/jenkins-scripts/lib/homebrew_bottle_creation.bash)
script:

* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=generic-release-homebrew_triggered_bottle_builder%2Flabel%3Dosx_highsierra)](https://build.osrfoundation.org/job/generic-release-homebrew_triggered_bottle_builder/label=osx_highsierra/) https://build.osrfoundation.org/job/generic-release-homebrew_triggered_bottle_builder/label=osx_highsierra
* [![Build Status](https://build.osrfoundation.org/buildStatus/icon?job=generic-release-homebrew_triggered_bottle_builder%2Flabel%3Dosx_mojave)](https://build.osrfoundation.org/job/generic-release-homebrew_triggered_bottle_builder/label=osx_mojave/) https://build.osrfoundation.org/job/generic-release-homebrew_triggered_bottle_builder/label=osx_mojave

If the bottle building job finishes without errors for each build configuration,
it will trigger a subsequent [repository\_uploader\_packages](https://build.osrfoundation.org/job/repository_uploader_packages/)
job that uploads the bottles to s3
and a [generic-release-homebrew\_pr\_bottle\_hash\_updater](https://build.osrfoundation.org/job/generic-release-homebrew_pr_bottle_hash_updater/)
job that commits the changes in bottle `sha256` values to the pull request branch
using [this script](https://github.com/ignition-tooling/release-tools/blob/master/jenkins-scripts/lib/homebrew_bottle_pullrequest.bash).
